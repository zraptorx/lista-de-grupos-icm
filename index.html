<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lista de Grupos ICM</title>
  <style>
    body{font-family:Arial,sans-serif;margin:20px;background:#fff;color:#111}
    #auth-screen{max-width:350px;margin:60px auto;text-align:center;border:1px solid #ddd;padding:30px;border-radius:15px;box-shadow:0 4px 10px rgba(0,0,0,0.05)}
    #app-screen{display:none}
    input{width:100%;padding:10px;margin:8px 0;border-radius:8px;border:1px solid #ccc;box-sizing:border-box}
    button{width:100%;padding:10px;border-radius:8px;border:1px solid #111;background:#f0f0f0;cursor:pointer;margin-top:10px}
    .small{font-size:12px;color:#666}
    footer{text-align:center;margin-top:20px;font-size:13px;color:#888}
    /* Estilos da Tabela */
    .tableWrap{width:100%;overflow-x:auto;margin-top:20px}
    table{border-collapse:collapse;width:max-content;min-width:100%}
    th,td{border:1px solid #ddd;padding:8px;text-align:center}
    .nameCol{position:sticky;left:0;background:#fff;font-weight:bold;min-width:200px;text-align:left;border-right:2px solid #ddd}
  </style>
</head>
<body>

<div id="auth-screen">
  <h1>üîê Acesso ICM</h1>
  <p class="small">Entre ou crie uma conta para o seu grupo.</p>
  <input type="email" id="email" placeholder="E-mail">
  <input type="password" id="pass" placeholder="Senha (m√≠n. 6 d√≠gitos)">
  <button id="btnLogin">Entrar</button>
  <button id="btnReg" style="border:none;text-decoration:underline;background:none">N√£o tenho conta, quero cadastrar</button>
  <footer>Criado por Romulo Peredo</footer>
</div>

<div id="app-screen">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <h2>üìã Minha Lista</h2>
    <button id="btnLogout" style="width:auto">Sair</button>
  </div>
  
  <div style="margin:20px 0;display:flex;gap:10px">
    <input type="text" id="newName" placeholder="Nome do membro" style="flex:1">
    <button id="btnAdd" style="width:auto;margin:0">Adicionar</button>
  </div>

  <div class="tableWrap"><table id="table"></table></div>
  <footer>Criado por Romulo Peredo</footer>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js";
  import { getFirestore, doc, setDoc, onSnapshot, updateDoc, deleteField } from "https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore.js";

  // Suas configura√ß√µes extra√≠das da imagem
  const firebaseConfig = {
    apiKey: "AIzaSyBBBkKZcscH0aHZBO0_5ydXpkh4lez9Enc",
    authDomain: "lista-de-grupos-icm.firebaseapp.com",
    projectId: "lista-de-grupos-icm",
    storageBucket: "lista-de-grupos-icm.firebasestorage.app",
    messagingSenderId: "676914873766",
    appId: "1:676914873766:web:25f4aea0809e1f4308fb67"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  const emailIn = document.getElementById('email');
  const passIn = document.getElementById('pass');

  // CADASTRO COM ALERTA DE ERRO REAL
  document.getElementById("btnReg").onclick = async () => {
    if (!emailIn.value || passIn.value.length < 6) return alert("E-mail v√°lido e senha de 6 d√≠gitos s√£o obrigat√≥rios!");
    
    try {
      await createUserWithEmailAndPassword(auth, emailIn.value, passIn.value);
      alert("Conta criada com sucesso!");
    } catch (error) {
      alert("ERRO NO FIREBASE: " + error.code); // Isso vai dizer se √© dom√≠nio bloqueado ou chave errada
      console.error(error);
    }
  };

  // LOGIN
  document.getElementById("btnLogin").onclick = async () => {
    try {
      await signInWithEmailAndPassword(auth, emailIn.value, passIn.value);
    } catch (error) {
      alert("Erro ao entrar: Verifique e-mail e senha.");
    }
  };

  // LOGOUT
  document.getElementById("btnLogout").onclick = () => signOut(auth);

  // MONITOR DE USU√ÅRIO
  onAuthStateChanged(auth, (user) => {
    if (user) {
      document.getElementById("auth-screen").style.display = "none";
      document.getElementById("app-screen").style.display = "block";
      carregarDados(user.uid);
    } else {
      document.getElementById("auth-screen").style.display = "block";
      document.getElementById("app-screen").style.display = "none";
    }
  });

  async function carregarDados(uid) {
    const docRef = doc(db, `usuarios/${uid}/dados`, "membros");
    onSnapshot(docRef, (snap) => {
      const lista = snap.exists() ? snap.data().people || [] : [];
      const tabela = document.getElementById("table");
      tabela.innerHTML = "<tr><th class='nameCol'>Nome</th></tr>" + 
        lista.map(p => `<tr><td class='nameCol'>${p.name}</td></tr>`).join("");
    });
  }

  document.getElementById("btnAdd").onclick = async () => {
    const nome = document.getElementById("newName").value.toUpperCase();
    if(!nome) return;
    const uid = auth.currentUser.uid;
    const docRef = doc(db, `usuarios/${uid}/dados`, "membros");
    // L√≥gica simplificada para teste
    await setDoc(docRef, { people: [{id: Date.now(), name: nome}] }, {merge: true});
    document.getElementById("newName").value = "";
  };
</script>
</body>
</html>